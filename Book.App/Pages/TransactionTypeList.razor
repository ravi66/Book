@page "/transactiontypelist"
@using Book.Shared;
@using MudBlazor

<PageTitle>@BookName - Transaction Types</PageTitle>

<MudContainer Class="pt-2 ps-1">

    <MudTable Elevation="5"
              Items="@TransactionTypes"
              @ref="_table"
              Dense="true"
              Hover="true"
              CanCancelEdit="true"
              CommitEditIcon="@Icons.Material.Filled.Save"
              @bind-SelectedItem="selectedTransactionType"
              SortLabel="Sort By"
              RowEditPreview="BackupItem"
              RowEditCancel="ResetItemToOriginalValues"
              IsEditRowSwitchingBlocked="@blockSwitch"
              EditTrigger="TableEditTrigger.EditButton"
              EditButtonPosition="TableEditButtonPosition.Start"
              ApplyButtonPosition="TableApplyButtonPosition.Start"
              RowEditCommit="ItemHasBeenCommitted">
        <ToolBarContent>
            <MudText Typo="Typo.h4">
                <MudIcon Icon="@Icons.Material.Filled.Payments" Color="Color.Primary" /> Transaction Types
            </MudText>
            <MudTooltip Color="Color.Primary" Text="Create Transaction Type">
                <MudIconButton Size="Size.Large"
                           Icon="@Icons.Material.Filled.AddBox"
                           Color="Color.Primary"
                           OnClick="AddTransactionType">
                </MudIconButton>
            </MudTooltip>
        </ToolBarContent>
        <HeaderContent>
            <MudTh></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<TransactionType, object>(x=>x.Name)">Name</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<TransactionType, object>(x=>x.SummaryName)">Summary</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<TransactionType, object>(x=>x.CreateDate)">Created</MudTableSortLabel></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Tools">
                <MudTooltip Color="Color.Primary" Text="Transactions">
                    <MudIconButton Icon="@Icons.Material.Filled.ReceiptLong"
                                   Color="Color.Primary"
                                   Size="Size.Small"
                                   aria-label="list transactions"
                                   OnClick="() => ListTransactions(context.TransactionTypeId, context.Name)" />
                </MudTooltip>

                @if (context.TransactionTypeId != -1 && context.TransactionCount == 0)
                {
                    <MudTooltip Color="Color.Primary" Text="Delete Transaction Type">
                        <MudIconButton Icon="@Icons.Material.Filled.Delete"
                                       Color="Color.Secondary"
                                       Size="Size.Small"
                                       aria-label="delete transaction type"
                                       OnClick="() => DeleteTransactionType(context.TransactionTypeId, context.Name)" />
                    </MudTooltip>
                }

            </MudTd>
            <MudTd DataLabel="Name">@context.Name</MudTd>
            <MudTd DataLabel="Summary">@context.SummaryName</MudTd>
            <MudTd DataLabel="Created">@context.CreateDate.ToShortDateString()</MudTd>
        </RowTemplate>
        <RowEditingTemplate>
            <MudTd DataLabel="Tools">

                @if (context.TransactionTypeId != 0)
                {
                    <MudTooltip Color="Color.Primary" Text="Transactions">
                        <MudIconButton Icon="@Icons.Material.Filled.ReceiptLong"
                                       Color="Color.Primary"
                                       Size="Size.Small"
                                       aria-label="list transactions"
                                       OnClick="()=> ListTransactions(context.TransactionTypeId, context.Name)" />
                    </MudTooltip>

                    @if (context.TransactionTypeId != -1 && context.TransactionCount == 0)
                    {
                        <MudTooltip Color="Color.Primary" Text="Delete Transaction Type">
                            <MudIconButton Icon="@Icons.Material.Filled.Delete"
                                           Color="Color.Secondary"
                                           Size="Size.Small"
                                           aria-label="delete transaction type"
                                           OnClick="() => DeleteTransactionType(context.TransactionTypeId, context.Name)" />
                        </MudTooltip>
                    }
                }
            </MudTd>
            <MudTd DataLabel="Name">
                <MudTextField @bind-Value="@context.Name"
                              Label="Name"
                              Required="true"
                              Variant="Variant.Outlined"
                              Margin="Margin.Dense" />
             </MudTd>
             <MudTd DataLabel="Summary">
                 <MudAutocomplete T="SummaryType"
                                  Required="true"
                                  Label="Summary"
                                  Style="width: 100%;"
                                  Variant="Variant.Outlined"
                                  Margin="Margin.Dense"
                                  @bind-Value="_SelectedSummaryType"
                                  Dense="true"
                                  SearchFunc="@SummarySearch"
                                  ToStringFunc="@(s => s == null ? null : $"{s.Name}")" />
             </MudTd>
             <MudTd DataLabel="Created">@context.CreateDate.ToShortDateString()</MudTd>
         </RowEditingTemplate>
         <EditButtonContent Context="button">
             <MudTooltip Text="Edit Transaction Type" Color="Color.Primary">
                 <MudIconButton Size="@Size.Medium"
                                Icon="@Icons.Material.Filled.Edit"
                                Class="pa-0"
                                OnClick="@button.ButtonAction"
                                Color="Color.Primary" />
             </MudTooltip>
         </EditButtonContent>
     </MudTable>
 </MudContainer>
