@using System.Globalization
@implements IDisposable

<MudDialog>

    <DialogContent  >

        <MudStack Row="true" AlignItems="AlignItems.Center" >
            <MudText Typo="Typo.h5">@DialogTitle</MudText>
            <MudSpacer />
            <MudIconButton Icon="@Icons.Material.Filled.Cancel" Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small" OnClick="Close" aria-label="close" />
        </MudStack>

        @if (Mode > 1)
        {
            <MudPaper Elevation="5" Class="mt-2 mb-2" MaxWidth="300px">
                <MudDateRangePicker Variant="Variant.Outlined" Label="Filter" Editable="true" DateRange="DateFilter" DateRangeChanged="HandleFilter" AutoClose="true" Margin="Margin.Dense" DisableUnderLine="true" DisableToolbar="true" />
            </MudPaper>
        }

        <MudTable Items="@Transactions" T="Transaction" Hover="true" Dense="true" AllowUnsorted="false" SortLabel="Sort By" >
            <HeaderContent>
                <MudTh><MudTableSortLabel SortBy="new Func<Transaction, object>(x=>x.TransactionTypeName)">Type</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<Transaction, object>(x=>x.Value)">Value</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel InitialDirection="SortDirection.Descending" SortBy="new Func<Transaction, object>(x=>x.TransactionDate)">Dated</MudTableSortLabel></MudTh>
                <MudTh>Tools</MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<Transaction, object>(x=>x.Notes)">Notes</MudTableSortLabel></MudTh>
            </HeaderContent>
            <NoRecordsContent>
                <MudText>No Entries found</MudText>
            </NoRecordsContent>
            <RowTemplate>
                <MudTd DataLabel="Type"><MudText>@context.TransactionTypeName</MudText></MudTd>
                <MudTd DataLabel="Value" Class="@context.CssClass"><MudText>@context.Value.ToString("C2")</MudText></MudTd>
                <MudTd DataLabel="Dated"><MudText>@context.TransactionDate.ToShortDateString()</MudText></MudTd>
                <MudTd DataLabel="Tools">
                    <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Primary" Size="Size.Small" aria-label="edit entry" OnClick="()=> EditTransaction(context.TransactionId)" />
                    <MudIconButton Icon="@Icons.Material.Filled.ContentCopy" Color="Color.Primary" Size="Size.Small" aria-label="copy entry" OnClick="()=> CopyTransaction(context.TransactionId, context.TransactionTypeName, context.Value)" />
                    <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Secondary" Size="Size.Small" aria-label="delete entry" OnClick="() => DeleteTransaction(context)" /> @*.TransactionId, context.TransactionTypeName, context.Value, context.TransactionDate.Year)" /> *@
                </MudTd>
                <MudTd DataLabel="Notes"><MudText>@context.Notes</MudText></MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager PageSizeOptions="new int[] { 8, 30, int.MaxValue }" HorizontalAlignment="HorizontalAlignment.Center" />
            </PagerContent>
        </MudTable>

    </DialogContent>
    
</MudDialog>
