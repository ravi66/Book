@using System.Globalization
@using Book.Buttons;
@implements IDisposable

<MudDialog>

    <DialogContent>

        <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Row="true">
            <MudText Typo="Typo.h5">@DialogTitle</MudText>
            <MudSpacer />
            <TransactionBtn IsIcon="true" TransactionId="0" Icon="@Icons.Material.Filled.AddCircleOutline" />
            <MudTooltip Text="Quit" Delay="500" Duration="0" ShowOnFocus="false" >
                <MudIconButton Icon="@Icons.Material.Filled.Cancel" Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small" OnClick="Close" aria-label="close" />
            </MudTooltip>
        </MudStack>

        <MudTable Class="mt-0" ServerData="@(new Func<TableState, Task<TableData<Transaction>>>(ServerReload))" Dense="true" Hover="true" @ref="table" SortLabel="Sort By" AllowUnsorted="false" >
            <ToolBarContent>
                <MudText >Entries</MudText>
                <MudSpacer />
                <MudTextField Variant="Variant.Outlined" Clearable="true" T="string" ValueChanged="@(e => OnSearch(e))" DisableUnderLine="true" Margin="Margin.Dense" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Small" ></MudTextField>
            </ToolBarContent>
            <HeaderContent>
                <MudTh><MudTableSortLabel SortLabel="type_field" T="Transaction" >Type</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortLabel="value_field" T="Transaction" >Value</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel InitialDirection="SortDirection.Descending" SortLabel="date_field" T="Transaction" >Dated</MudTableSortLabel></MudTh>
                <MudTh>Tools</MudTh>
                <MudTh><MudTableSortLabel SortLabel="notes_field" T="Transaction" >Notes</MudTableSortLabel></MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Type"><MudText>@context.TransactionTypeName</MudText></MudTd>
                <MudTd DataLabel="Value" Class="@GetValueCSS(context.Value)"><MudText>@context.Value.ToString("C2")</MudText></MudTd>
                <MudTd DataLabel="Dated"><MudText>@context.TransactionDate.ToShortDateString()</MudText></MudTd>
                <MudTd DataLabel="Tools">
                    <TransactionBtn IsIcon="true" TransactionId="context.TransactionId" Icon="@Icons.Material.Filled.Edit" />
                    <CopyTransactionBtn Transaction="@context" Variant="@Variant.Text" Size="@Size.Small" />
                    <DeleteTransactionBtn Transaction="@context" Variant="@Variant.Text" Size="@Size.Small" />
                </MudTd>
                <MudTd DataLabel="Notes"><MudText>@context.Notes</MudText></MudTd>
            </RowTemplate>
            <NoRecordsContent>
                <MudText>No Entries found</MudText>
            </NoRecordsContent>
            <LoadingContent>
                <MudText>Loading Entries...</MudText>
            </LoadingContent>
            <PagerContent>
                <MudTablePager PageSizeOptions="new int[] { 8, 30, int.MaxValue }" HorizontalAlignment="HorizontalAlignment.Center" />
            </PagerContent>
        </MudTable>

    </DialogContent>
    
</MudDialog>
