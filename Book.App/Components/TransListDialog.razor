@using System.Globalization

<MudDialog>
    <DialogContent >

        <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.Center" >
            <MudPaper Elevation="2" >
                <MudText Typo="Typo.h5">@DialogTitle</MudText>
            </MudPaper>
        </MudStack>

        @if (Mode > 1)
        {
            <MudStack Row="true" Justify="Justify.Center" AlignItems="AlignItems.Center" >
                <MudPaper Elevation="2" >
                    <MudDateRangePicker Variant="Variant.Outlined"
                                        Label="Filter"
                                        Editable="true"
                                        @bind-DateRange="_dateRange"
                                        AutoClose="true"
                                        Margin="Margin.Dense" />
                </MudPaper>
                <MudTooltip Color="Color.Primary" Text="Filter">
                    <MudIconButton Icon="@Icons.Material.Filled.Search" OnClick="HandleFilter" Color="Color.Primary" Size="Size.Large" aria-label="filter" />
                </MudTooltip>
                <MudSpacer />
            </MudStack>
        }

        @if (Transactions.Count() == 0)
        {
            <MudStack>
                <MudCard Style="width: 100%;" Elevation="2">
                    <MudText Typo="Typo.h6">No transactions found</MudText>
                </MudCard>
            </MudStack>
        }
        else
        {
            <MudTable   Items="@Transactions"
                        T="Transaction"
                        Hover="true"
                        @ref="_table"
                        Dense="true" >
                <HeaderContent>
                    <MudTh><MudText>Tools</MudText></MudTh>
                    <MudTh><MudTableSortLabel SortBy="new Func<Transaction, object>(x=>x.Value)"><MudText>Value</MudText></MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortBy="new Func<Transaction, object>(x=>x.TransactionTypeName)"><MudText>Type</MudText></MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortBy="new Func<Transaction, object>(x=>x.TransactionDate)"><MudText>Dated</MudText></MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortBy="new Func<Transaction, object>(x=>x.Notes)"><MudText>Notes</MudText></MudTableSortLabel></MudTh>
                </HeaderContent>
                <RowTemplate >
                    <MudTd DataLabel="Tools">
                        <MudTooltip Color="Color.Primary" Text="Edit Transaction">
                            <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Primary" Size="Size.Small" aria-label="copy" OnClick="()=> EditTransaction(context.TransactionId)" />
                        </MudTooltip>
                        <MudTooltip Color="Color.Primary" Text="Copy Transaction">
                            <MudIconButton Icon="@Icons.Material.Filled.ContentCopy" Color="Color.Primary" Size="Size.Small" aria-label="copy" OnClick="()=> CopyTransaction(context.TransactionId, context.TransactionTypeName, context.Value)" />
                        </MudTooltip>
                        <MudTooltip Color="Color.Primary" Text="Delete Transaction">
                            <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Secondary" Size="Size.Small" aria-label="delete" OnClick="() => DeleteTransaction(context.TransactionId, context.TransactionTypeName, context.Value)" />
                        </MudTooltip>
                    </MudTd>
                    <MudTd DataLabel="Value" Class="@context.CssClass"><MudText>@context.Value.ToString("C2")</MudText></MudTd>
                    <MudTd DataLabel="Type"><MudText>@context.TransactionTypeName</MudText></MudTd>
                    <MudTd DataLabel="Dated"><MudText>@context.TransactionDate.ToShortDateString()</MudText></MudTd>
                    <MudTd DataLabel="Notes"><MudText>@context.Notes</MudText></MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager PageSizeOptions="new int[] { 5, 10, 20, 50, int.MaxValue }"
                                   HorizontalAlignment="HorizontalAlignment.Center" />
                </PagerContent>
            </MudTable>
        }

    </DialogContent>
</MudDialog>
